# CV Analysis 

Part 1: FIJI_MACRO_CV
This Macro runs in Fiji/ImageJ, it creates masks, segments nuclei and generates individual files with individual nuclei for CV analysis in Matlab (Part 2)

Part 2: MATLAB_CV_CONFOCAL
This script calculates the coefficient of variation of each segmented nucleus generated in Fiji (Part 1).

## Input 

Part 1:
Confocal single stack images or Z projections of DAPI/Hoechst staining in `.tiff` format. 

Part 2: 
`.tiff` segmented nuclei generated by Part 1. 
  
## Output 
Part 1: 

	•`.tiff` files of individual segmented nuclei. 

Part 2:

	•`.csv` file with CV values for each nucleus analysed and MatLab Workspace (both files will be saved automatically).

	•`.fig` files, three figures displaying the intensity profiles of: individual nuclei, of average values per category, and of CV boxplot (Optional). Figures are automatically saved. 

  
## Composed by: 
Part 1: FIJI_MACRO_CV: Macro to be executed in Fiji/ImageJ

Part 2: MATLAB_CV_Confocal.m

  
## Tested
Tested using Fiji/ImageJ 2.1.0/1.53c & Matlab_R2016b

  
## Authors 
Code by Laura Martin and Chiara Vicario 
README and annotation updated by Victoria Neguembor and Laura Martin

  
## Deployment

To deploy this project run

```
Part 1
- Paste Macro within folder you want to analyse. 
- Open in Fiji the image you want to analyze (**previously saved in .tiff format). 
- Go to Plugins > Macros > Run > Select Macro "FIJI_MACRO_CV". 
- Individual .tiff files for each nucleus will be automatically saved in the source folder. 
- Also, a screenshot of the mask generated (.png) and the ROI generated (.zip) will be automatically saved. 
- Before proceeding to PART 2 in MatLab, verify that the masks are generated correctly by checking the screenshot saved (.png). 
- Depending on cell type and confluency you might need to adjust the following parameters in the Macro:
	•	run("Gaussian Blur...", "sigma=2"); if necessary increase sigma value to smooth the masks 
	•	setThreshold(12, 255); if necessary adjust minimum value (decrease for very dim images or increase in cases of high background) 
	•	run("Watershed"); remove line if you observe too many nuclear segmented in pieces
	•	run("Analyze Particles...", "size=50-Infinity exclude add"); decrease minimum size value (i.e. "50") if small nuclei get excluded; 
	•	run("Analyze Particles...", "size=50-Infinity exclude add"); if desired remove "exclude" to include nuclei at edges of image
- If you want to discard nuclei that were not correctly segmented, erase the files with the corresponding ROI number.   
- Repeat the same process for every .tiff whose nuclei you want to analyse.
- Be careful to close the ROI Manager tool every time you open a new .tiff to analyse.

Part 2
- Open "MATLAB_CV_Confocal.m"
- Adjust the following parameters:
  •	"edges = 0:1:255". Adjust the first and last numbers according to the bits of your image (i.e. 0:x:255 for 8-bit images, 0:x:25516 for 16-bit images). Adjust the middle number according to the binning desired (the higher the number, the smoother the plot).
  •	"categ = 2" adjust number of experimental categories
  •	“Folder”: the folder in which you want the output files (.mat, .xlsx, .fig) to be automatically saved
  •	"categname" adjust desired names of experimental categories
  •	"colors" choose desired color code or go for random colors assignation (colormap(jet()) function). The number of colors should be equal to the number of categories ( i.e. categ = 3; colors = colormap(jet(3)); )
  •	“legend” adjust name of desired legends for plot
  •     "xlim([0 255])": modify the x-axis of the 2nd plot according to the bit of your image (as for the "edges").

- Run script
- Load .bin files for each category. 
- The script will generate 2 Figures: the 1st one for the distribution of pixel intensities of single cells, and the 2nd for the mean and standard deviation of the distribution of pixel intensities for each category
- The script will ask you if you want to visualise a boxplot of CV. Write Y or N and press Enter. (Yes to visualise, No will skip visualisation). If Y, the box plot will appear as a 3rd figure.
- The analysis results will be automatically saved in the Source folder. In details:
	•	CVanalysis_workspace.mat
	•	CVanalysis_result.xlsx
	•	CV_Histoplot_individualcells.fig
	•	CV_Histoplot_smooth.fig
	•	Coefficient_Variation_Boxplot.fig (Optional). 

```
## Research Implementation 
Neguembor et al Mol Cell 2021: Coefficient of variation analysis.
For the assessment of chromatin compaction through the Coefficient of Variation (CV) analysis, DAPI stained cells treated with the different inhibitory drugs were imaged on a Leica TCS SP8 confocal microscope. Central sections of the nuclei were used to measure the CV. We generated a work-flow in ImageJ 2.0.0 consisting of the creation of masks corresponding to the nuclei which were then applied to the raw image to allow the selection of single nuclei. The coefficient of variation (CV) of individual nuclei was calculated in Matlab, with CV=s/m, where s represents the standard deviation of the intensity values and m representing the mean value of intensity of the nucleus.
